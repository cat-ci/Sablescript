<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Sablescript</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Emoji:wght@300..700&display=swap" rel="stylesheet">

        <link
              rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/codemirror.min.css"
              />

        <link
              rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/theme/eclipse.min.css"
              />


        <link
              rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/addon/hint/show-hint.min.css"
              />
        <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/cat-ci/Sablescript/refs/heads/main/.github/sablescript.ico">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: Arial, sans-serif;
            }

            html, body {
                height: 100%;
                background: url("https://raw.githubusercontent.com/cat-ci/Sablescript/refs/heads/main/.github/bliss.webp") no-repeat center center fixed;
                background-size: cover;
                overflow-x: hidden;
            }

            body {
                display: flex;
                flex-direction: row;
            }

            /* Sidebar */
            .sidebar {
                width: 200px;
                border-right: 1px solid transparent;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                background: transparent;
            }

            .sidebar-top {
                display: flex;
                flex-direction: column;
                padding: 8px;
            }

            .sidebar-search {
                margin-bottom: 8px;
            }

            .sidebar-search input {
                width: 100%;
                padding: 4px 6px;
                border: 1px solid #ccc;
                border-radius: 3px;
                background: transparent;
                color: #333;
            }

            /* New file button */
            #btnNew {
                width: 100%;
                margin-bottom: 8px;
                border: 1px solid #ccc;
                border-radius: 3px;
                padding: 6px;
                cursor: pointer;
                font-weight: 800;
                backdrop-filter: blur(5px);
                transition: all 0.2s ease-in-out;
            }

            #btnNew:hover {
                filter: brightness(90%);
                backdrop-filter: blur(8px);
            }

            /* Load/Save Buttons */
            .load-save-row {
                display: flex;
                flex-direction: row;
                margin-bottom: 8px;
            }

            .load-save-row button {
                flex: 1;
                margin-right: 4px;
                border: 1px solid #ccc;
                border-radius: 3px;
                cursor: pointer;
                font-family: Noto Emoji;
                backdrop-filter: blur(5px);
                transition: all 0.2s ease-in-out;
                 background-color: #1e1e2e;
                backdrop-filter: blur(10px);
                filter:opacity(70%);
            }

            .load-save-row button:last-child {
                margin-right: 0;
            }

            .load-save-row button:hover {
                filter: brightness(90%);
                filter:opacity(70%);
            }
            .load-save-row button img{
             	filter:invert(100%);   
            }

            /* Tabs */
            .tabs-container {
                background-color: #1e1e2e;
                backdrop-filter: blur(10px);
                filter:opacity(70%);
                min-height: 100px;
                max-height:200px;
                border-radius: 3px;
                overflow-y: auto;
                padding: 4px;
            }

            .tab-item {
                position: relative;
                padding: 4px 6px;
                margin-bottom: 4px;
                border-radius: 3px;
                cursor: pointer;
                user-select: none;
                background: transparent;
                color: white;
            }

            .tab-item:hover {
                filter: brightness(90%);
                backdrop-filter: blur(20px);
            }

            .tab-item.active {
                filter: brightness(75%);
                border-color: #66aaff;
            }

            /* Tab Title */
            .tab-title {
                display: inline-block;
            }

            .tab-rename-input {
                display: none;
                width: calc(100% - 26px);
                border: 1px solid #ccc;
                border-radius: 3px;
                padding: 2px 4px;
            }

            /* Tab Close Button */
            .tab-close {
                position: absolute;
                right: 4px;
                top: 4px;
                display: none;
                cursor: pointer;
                font-weight: bold;
                color: #777;
            }

            .tab-item:hover .tab-close {
                display: inline;
            }

            .tab-close:hover {
                color: red;
            }

            /* Sidebar Bottom */
            .sidebar-bottom {
                padding: 8px;
                display: flex;
                justify-content: space-between;
                border-top: 1px solid #ccc;
            }

            .sidebar-bottom button {
                border: 1px solid #ccc;
                border-radius: 3px;
                padding: 4px 6px;
                cursor: pointer;
                font-size: 12px;
                backdrop-filter: blur(5px);
                transition: all 0.2s ease-in-out;
            }

            .sidebar-bottom button:hover {
                filter: brightness(90%);
                backdrop-filter: blur(8px);
            }

            /* Main Section */
            .main-section {
                flex: 1;
                display: flex;
                flex-direction: column;
            }

            /* Top Bar */
            .topbar {
                display: flex;
                align-items: center;
                border-bottom: 1px solid transparent;
                min-height: 40px;
                padding: 0 10px;
                background: transparent;
            }

            /* File Info */
            .file-info {
                flex: 1;
                text-align: center;
                position: relative;
                user-select: none;
            }

            .filename-label {
                display: inline-block;
                padding-right: 3px;
                cursor: text;
                color:white;
            }

            .filename-input {
                display: none;
                width: 150px;
                border: 1px solid #ccc;
                border-radius: 3px;
                padding: 2px 4px;
                text-align: right;
                margin-right: 3px;
                color:white;
                filter:opacity(70%);
            }

            .filename-ext {
                appearance: none;
                border: none;
                background: transparent;
                font-family: inherit;
                font-size: inherit;
                cursor: pointer;
                color:white;
                outline:none;
            }

            .filename-ext option {
                color: #333;
            }

            /* Buttons in Top Bar */
            .topbar button {
                border-radius: 3px;
                cursor: pointer;
                padding:0;
                backdrop-filter: blur(5px);
                transition: all 0.2s ease-in-out;
                height:20px;
                
            }
            .topbar button img{
            	margin:0;
                padding:0;
                filter:invert(100%);
            }

            .topbar button:hover {
                filter: brightness(90%);
                backdrop-filter: blur(8px);
            }

            /* Editor Container */
            .editor-container {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                background: transparent;
                margin-right:10px;
                margin-bottom:5px;
                margin-left:10px;
            }

            /* CodeMirror Styling */
            .CodeMirror {
                height: 100%;
            }

            .CodeMirror-wrap {
                overflow-x: auto;
                overflow-y: hidden;
                white-space: pre;
            }

            .CodeMirror-scroll {
                min-width: 100%;
                overflow-x: auto !important;
            }

            /* Status Bar */
            .status-bar {
                height: 24px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0 10px;
                font-size: 13px;
                background: transparent;
                color:white;
                filter:opacity(70%);
            }

            /* Buttons */
            button {
                background-color:transparent;
                border:none;
                padding: 4px 8px;
                cursor: pointer;
                border-radius: 5px;
                backdrop-filter: blur(5px);
                transition: all 0.2s ease-in-out;
                
            }

            button:hover {
                filter: brightness(90%);
                backdrop-filter: blur(8px);
            }

            /* Tabs */
            .tab {
                border: 1px solid #999;
                cursor: pointer;
                padding: 2px;
                border-radius: 0;
                border-top-left-radius: 5px;
                border-top-right-radius: 5px;
                background: transparent;
            }

            .tab.active {
                filter: brightness(80%);
            }

            /* Button Group */
            .btn-group {
                display: none;
                flex-wrap: wrap;
            }

        </style>
        <style>
            .cm-s-custom-dark {
                background: #1e1e2e;
                backdrop-filter: blur(10px);
                filter:opacity(70%);
                color: #cdd6f4;
                font-family: 'Fira Code', monospace;
                font-size: 14px;
                line-height: 1.5;
                border-radius: 8px;
                padding: 8px;
            }

            .cm-s-custom-dark .CodeMirror-linenumber {
                color: #6c7086;
            }

            .cm-s-custom-dark .CodeMirror-cursor {
                border-left: 2px solid #89b4fa !important;
                animation: cursor-blink 1s step-end infinite;
            }

            @keyframes cursor-blink {
                50% { opacity: 0; }
            }

            .cm-s-custom-dark .CodeMirror-selected {
                background: rgba(137, 180, 250, 0.2) !important;
            }

            .cm-s-custom-dark .CodeMirror-scrollbar-filler,
            .cm-s-custom-dark .CodeMirror-gutter-filler {
                background: #181825;
            }

            .cm-s-custom-dark .CodeMirror-vscrollbar,
            .cm-s-custom-dark .CodeMirror-hscrollbar {
                background: #181825;
            }

            .cm-s-custom-dark ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }

            .cm-s-custom-dark ::-webkit-scrollbar-thumb {
                background: #45475a;
                border-radius: 4px;
            }

            .cm-s-custom-dark ::-webkit-scrollbar-thumb:hover {
                background: #585b70;
            }

            /* --- Syntax Highlighting --- */

            /* Keywords */
            .cm-s-custom-dark .cm-keyword {
                color: #cba6f7;
                font-weight: bold;
            }

            /* Strings */
            .cm-s-custom-dark .cm-string {
                color: #a6e3a1;
            }

            /* Numbers */
            .cm-s-custom-dark .cm-number {
                color: #fab387;
            }

            /* Variables */
            .cm-s-custom-dark .cm-variable {
                color: #f9e2af;
            }

            /* Operators */
            .cm-s-custom-dark .cm-operator {
                color: #f38ba8;
            }

            /* Functions */
            .cm-s-custom-dark .cm-def {
                color: #89b4fa;
                font-weight: bold;
            }

            /* Comments */
            .cm-s-custom-dark .cm-comment {
                color: #6c7086;
                font-style: italic;
            }

            /* Brackets */
            .cm-s-custom-dark .cm-bracket {
                color: #f5e0dc;
            }

            /* Matching Brackets */
            .cm-s-custom-dark .CodeMirror-matchingbracket {
                background: rgba(255, 184, 108, 0.3);
                border-bottom: 2px solid #fab387;
            }

            /* HTML Tags */
            .cm-s-custom-dark .cm-tag {
                color: #f38ba8;
            }

            /* Attributes */
            .cm-s-custom-dark .cm-attribute {
                color: #f9e2af;
            }

            /* CSS Properties */
            .cm-s-custom-dark .cm-property {
                color: #fab387;
            }

            /* CSS Values */
            .cm-s-custom-dark .cm-variable-2 {
                color: #94e2d5;
            }

            /* --- Editor Styling --- */
            .CodeMirror {
                height: 100%;
                border-radius: 8px;
            }

            /* Matching Bracket Highlight */
            .CodeMirror-matchingbracket {
                outline: 1px solid #fab387;
            }

            /* Gutter */
            .cm-s-custom-dark .CodeMirror-gutters {
                background: #1e1e2e;
                border-right: 1px solid #313244;
            }
        </style>

    </head>

    <body>


        <div class="sidebar">
            <div class="sidebar-top">

                <div class="sidebar-search">
                    <input type="search" placeholder="Search..." />
                </div>


                <button id="btnNew">+</button>


                <div class="load-save-row">
                    <button id="btnLoad"><img style="width:15px;" src="https://github.com/cat-ci/Sablescript/blob/main/.github/open.png?raw=true"></button>
                    <button id="btnSave"><img style="width:15px;" src="https://github.com/cat-ci/Sablescript/blob/main/.github/save.png?raw=true"></button>
                </div>


                <div class="tabs-container" id="tabsContainer">

                </div>
            </div>

            <div class="sidebar-bottom">
                <button id="btnExtensions">Ext</button>
                <button id="btnSettings">Settings</button>
            </div>
        </div>


        <div class="main-section">


            <div class="topbar">
                <div class="functions">
                    <button id="sidebar"><img src="https://github.com/cat-ci/Sablescript/blob/main/.github/sidebar-toggle.png?raw=true" style="width:20px;"></button>
                    <button id="copy"><img src="https://github.com/cat-ci/Sablescript/blob/main/.github/copy.png?raw=true" style="width:20px;"></button>
                    <button id="repair">Repair</button>
                </div>
                <div class="file-info">

                    <span class="filename-label" id="filenameBaseLabel">untitled</span>

                    <input
                           type="text"
                           class="filename-input"
                           id="filenameBaseInput"
                           value="untitled"
                           />

                    <select id="filenameExt" class="filename-ext">
                        <option value="txt">.txt</option>
                        <option value="html">.html</option>
                        <option value="css">.css</option>
                        <option value="js">.js</option>
                        <option value="py">.py</option>
                        <option value="php">.php</option>
                    </select>
                </div>
                <button id="btnRun"><img src="https://github.com/cat-ci/Sablescript/blob/main/.github/play-332.png?raw=true" style="width:20px;"></button>
            </div>


            <div class="editor-container">
                <textarea id="codeEditor"></textarea>
            </div>
            <div class="status-bar">
                <div id="statusText">Line 1, Col 1</div>
                <div id="statusEncoding">UTF-8 | Windows (CR LF)</div>
            </div>
        </div>


        <input
               type="file"
               id="fileInput"
               accept=".txt,.html,.css,.js,.json,.md,.xml,.c,.cpp,.java,.py"
               style="display: none"
               />


        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/codemirror.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/javascript/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/css/css.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/htmlmixed/htmlmixed.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/xml/xml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/clike/clike.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/php/php.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/python/python.min.js"></script>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/addon/edit/closetag.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/addon/hint/show-hint.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/addon/hint/xml-hint.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/addon/hint/html-hint.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/addon/hint/css-hint.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/addon/hint/javascript-hint.min.js"></script>



        <script>

            let tabs = [];
            let currentTabId = null;

            function getModeFromExtension(ext) {
                switch (ext) {
                    case 'html': return 'htmlmixed';
                    case 'css':  return 'css';
                    case 'js':   return 'javascript';
                    case 'py':   return 'python';
                    case 'php':  return 'php';
                    case 'c':
                    case 'cpp':
                    case 'java': return 'text/x-c++src';
                    default:     return 'plaintext';
                }
            }

            function createNewTab(baseName = 'untitled', extension = 'txt', content = '') {
                const newId = Date.now();
                tabs.push({ id: newId, name: baseName, extension, content });
                return newId;
            }

            function renderTabs() {
                const tabsContainer = document.getElementById('tabsContainer');
                tabsContainer.innerHTML = '';

                tabs.forEach((tab) => {
                    const tabEl = document.createElement('div');
                    tabEl.className = 'tab-item' + (tab.id === currentTabId ? ' active' : '');
                    tabEl.setAttribute('data-id', tab.id);


                    const titleSpan = document.createElement('span');
                    titleSpan.className = 'tab-title';
                    titleSpan.textContent = tab.name + '.' + tab.extension;
                    tabEl.appendChild(titleSpan);


                    const renameInput = document.createElement('input');
                    renameInput.type = 'text';
                    renameInput.className = 'tab-rename-input';
                    renameInput.value = tab.name;
                    tabEl.appendChild(renameInput);


                    const closeSpan = document.createElement('span');
                    closeSpan.className = 'tab-close';
                    closeSpan.textContent = 'x';
                    tabEl.appendChild(closeSpan);


                    tabEl.addEventListener('click', (e) => {
                        if (e.target === closeSpan) return;
                        switchToTab(tab.id);
                    });

                    titleSpan.addEventListener('dblclick', (e) => {
                        e.stopPropagation();
                        startTabRename(tab.id, tabEl);
                    });

                    closeSpan.addEventListener('click', (e) => {
                        e.stopPropagation();
                        closeTab(tab.id);
                    });


                    renameInput.addEventListener('blur', () => {
                        finishTabRename(tab.id, renameInput.value);
                    });
                    renameInput.addEventListener('keydown', (evt) => {
                        if (evt.key === 'Enter') {
                            evt.preventDefault();
                            finishTabRename(tab.id, renameInput.value);
                        }
                    });

                    tabsContainer.appendChild(tabEl);
                });
            }

            function startTabRename(tabId, tabEl) {
                const titleSpan = tabEl.querySelector('.tab-title');
                const renameInput = tabEl.querySelector('.tab-rename-input');
                titleSpan.style.display = 'none';
                renameInput.style.display = 'inline-block';
                renameInput.focus();
                renameInput.select();
            }

            function finishTabRename(tabId, newName) {
                const tab = tabs.find(t => t.id === tabId);
                if (!tab) return;
                newName = newName.trim() || 'untitled';
                tab.name = newName;
                renderTabs();

                if (tabId === currentTabId) {
                    filenameBaseLabel.textContent = tab.name;
                    filenameBaseInput.value = tab.name;
                }
            }

            function closeTab(tabId) {
                const index = tabs.findIndex(t => t.id === tabId);
                if (index === -1) return;
                tabs.splice(index, 1);

                if (tabId === currentTabId) {

                    if (tabs.length > 0) {
                        switchToTab(tabs[tabs.length - 1].id);
                    } else {

                        currentTabId = null;
                        const newTabId = createNewTab();
                        switchToTab(newTabId);
                    }
                } else {
                    renderTabs();
                }
            }

            function switchToTab(tabId) {

                if (currentTabId !== null) {
                    const currentTab = tabs.find(t => t.id === currentTabId);
                    if (currentTab) {
                        currentTab.content = editor.getValue();
                        currentTab.name = filenameBaseInput.value.trim() || 'untitled';
                        currentTab.extension = filenameExt.value;
                    }
                }
                currentTabId = tabId;
                const newTab = tabs.find(t => t.id === currentTabId);
                if (!newTab) return;

                editor.setValue(newTab.content || '');
                editor.setOption('mode', getModeFromExtension(newTab.extension));
                filenameBaseLabel.textContent = newTab.name;
                filenameBaseInput.value = newTab.name;
                filenameExt.value = newTab.extension;

                renderTabs();
            }


            const editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
                lineNumbers: true,
                mode: 'plaintext',
                theme: 'custom-dark',
                tabSize: 4,
                indentUnit: 4,
                autoCloseTags: true,
                extraKeys: {
                    'Ctrl-Space': 'autocomplete',

                    'Tab': function(cm) {
                        if (cm.somethingSelected()) {
                            cm.indentSelection('add');
                        } else {
                            cm.replaceSelection('\t');
                        }
                    },

                    'Shift-Tab': function(cm) {
                        if (cm.somethingSelected()) {
                            cm.indentSelection('subtract');
                        }
                    }
                }
            });




            editor.on('inputRead', function(cm, change) {
                let mode = cm.getOption('mode');
                let cursor = cm.getCursor();
                let token = cm.getTokenAt(cursor);
                let shouldAutocomplete = false;

                if (mode === 'htmlmixed') {
                    if (change.text[0] === '<' || token.type === 'tag' || token.type === 'attribute') {
                        shouldAutocomplete = true;
                    }

                    if (token.state.context && token.state.context.tagName === "script") {
                        cm.setOption("mode", "javascript");
                        shouldAutocomplete = true;
                    }

                    if (token.state.context && token.state.context.tagName === "style") {
                        cm.setOption("mode", "css");
                        shouldAutocomplete = true;
                    }
                }
                else if (mode === 'javascript') {
                    if (/\w|\./.test(change.text[0])) {
                        shouldAutocomplete = true;
                    }
                }
                else if (mode === 'css') {
                    if (token.type === 'property' || token.type === 'variable-3' || token.type === 'keyword' || change.text[0] === ':') {
                        shouldAutocomplete = true;
                    }
                }
                else if (mode === 'python') {
                    if (/\w|\./.test(change.text[0])) {
                        shouldAutocomplete = true;
                    }
                }
                else if (mode === 'php') {
                    if (token.type === 'variable' || change.text[0] === '$' || token.type === 'keyword') {
                        shouldAutocomplete = true;
                    }
                }

                if (shouldAutocomplete) {
                    CodeMirror.commands.autocomplete(cm, null, { completeSingle: false });
                }
            });

            const statusText = document.getElementById('statusText');
            editor.on('cursorActivity', function() {
                const pos = editor.getCursor();
                statusText.textContent = `Line ${pos.line + 1}, Col ${pos.ch + 1}`;
            });


            const btnNew = document.getElementById('btnNew');
            const btnLoad = document.getElementById('btnLoad');
            const btnSave = document.getElementById('btnSave');
            const btnRun = document.getElementById('btnRun');
            const fileInput = document.getElementById('fileInput');

            const filenameBaseLabel = document.getElementById('filenameBaseLabel');
            const filenameBaseInput = document.getElementById('filenameBaseInput');
            const filenameExt = document.getElementById('filenameExt');


            filenameBaseLabel.addEventListener('dblclick', () => {
                filenameBaseLabel.style.display = 'none';
                filenameBaseInput.style.display = 'inline-block';
                filenameBaseInput.focus();
                filenameBaseInput.select();
            });
            filenameBaseInput.addEventListener('blur', () => {
                applyTopBarRename();
            });
            filenameBaseInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    applyTopBarRename();
                }
            });
            function applyTopBarRename() {
                const newName = filenameBaseInput.value.trim() || 'untitled';
                filenameBaseLabel.textContent = newName;
                filenameBaseInput.style.display = 'none';
                filenameBaseLabel.style.display = 'inline-block';
                if (currentTabId !== null) {
                    const tab = tabs.find(t => t.id === currentTabId);
                    if (tab) {
                        tab.name = newName;
                        renderTabs();
                    }
                }
            }


            filenameExt.addEventListener('change', () => {
                if (currentTabId === null) return;
                const currentTab = tabs.find(t => t.id === currentTabId);
                if (currentTab) {
                    currentTab.extension = filenameExt.value;
                    editor.setOption('mode', getModeFromExtension(currentTab.extension));
                    renderTabs();
                }
            });


            function createAndSwitchToNewTab() {
                const newTabId = createNewTab();
                switchToTab(newTabId);
            }


            btnNew.addEventListener('click', createAndSwitchToNewTab);


            btnLoad.addEventListener('click', () => {
                fileInput.click();
            });
            fileInput.addEventListener('change', function() {
                const file = this.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const parts = file.name.split('.');
                    const baseName = parts.slice(0, -1).join('.') || 'untitled';
                    const extension = parts.slice(-1)[0] || 'txt';
                    const newTabId = createNewTab(baseName, extension, e.target.result);
                    switchToTab(newTabId);
                };
                reader.readAsText(file);
                this.value = '';
            });


            btnSave.addEventListener('click', saveFile);
            function saveFile() {
                if (currentTabId === null) return;
                const tab = tabs.find(t => t.id === currentTabId);
                if (!tab) return;
                tab.content = editor.getValue();
                tab.name = filenameBaseInput.value.trim() || 'untitled';
                tab.extension = filenameExt.value;

                const textToSave = tab.content;
                const blob = new Blob([textToSave], { type: 'text/plain' });
                const filename = `${tab.name}.${tab.extension}`;

                const tempLink = document.createElement('a');
                tempLink.href = URL.createObjectURL(blob);
                tempLink.download = filename;
                tempLink.click();
                URL.revokeObjectURL(tempLink.href);
            }


            btnRun.addEventListener("click", function() {
                var codeContent = editor.getValue();


                var newWindow = window.open("", "miniWindow", "width=600,height=400,resizable=yes");

                if (newWindow) {
                    newWindow.document.write(codeContent);
                    newWindow.document.close();
                } else {
                    alert("Popup blocked! Please allow pop-ups for this site.");
                }
            });



            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
                    e.preventDefault();
                    saveFile();
                } else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'o') {
                    e.preventDefault();
                    fileInput.click();
                } else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n') {
                    e.preventDefault();
                    createAndSwitchToNewTab();
                }
            });


            (function init() {
                const initialTabId = createNewTab('untitled', 'txt', '');
                switchToTab(initialTabId);
            })();
        </script>
        <script>
            window.addEventListener("beforeunload", (event) => {
                event.preventDefault();
                event.returnValue = ""; // Required for modern browsers
            });
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const select = document.getElementById("filenameExt");
                const tabContainer = document.getElementById("tabContainer");
                const tabs = document.querySelectorAll(".tab");
                const groups = document.querySelectorAll(".btn-group");

                function showGroup(groupName) {
                    groups.forEach(group => {
                        group.style.display = "none";
                    });

                    if (groupName === "html") {
                        tabContainer.style.display = "block";
                        document.querySelector(".btn-group.html").style.display = "flex";
                    } else {
                        tabContainer.style.display = "none";
                        const activeGroup = document.querySelector(`.btn-group.${groupName}`);
                        if (activeGroup) activeGroup.style.display = "flex";
                    }
                }

                select.addEventListener("change", function () {
                    showGroup(this.value);
                });

                tabs.forEach(tab => {
                    tab.addEventListener("click", function () {
                        tabs.forEach(t => t.classList.remove("active"));
                        this.classList.add("active");

                        groups.forEach(group => group.style.display = "none");
                        document.querySelector(`.btn-group.${this.dataset.tab}`).style.display = "flex";
                    });
                });

                showGroup(select.value);
            });
        </script>
        <script>
            editor.on("change", function () {
                const cmWrapper = document.querySelector(".CodeMirror");
                cmWrapper.style.minWidth = "100%";
                cmWrapper.style.maxWidth = "none";
            });

        </script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const sidebar = document.querySelector(".sidebar");
                const toggleButton = document.getElementById("sidebar");
                const copyButton = document.getElementById("copy");
                const repairButton = document.getElementById("repair");

                let sidebarVisible = true;

                toggleButton.addEventListener("click", function () {
                    sidebarVisible = !sidebarVisible;
                    sidebar.style.display = sidebarVisible ? "flex" : "none";
                });

                copyButton.addEventListener("click", function () {
                    if (!editor) return;

                    const currentContent = editor.getValue();

                    navigator.clipboard.writeText(currentContent).then(() => {
                    }).catch(err => {
                        console.error("Failed to copy: ", err);
                    });
                });

                repairButton.addEventListener("click", function () {
                    if (!editor) return;

                    editor.operation(() => {
                        let lines = [];
                        for (let i = 0; i < editor.lineCount(); i++) {
                            let line = editor.getLine(i).trim();
                            lines.push(line);
                        }

                        let formattedCode = lines.join("\n");

                        editor.replaceRange(formattedCode, { line: 0, ch: 0 }, { line: editor.lineCount(), ch: 0 });

                        for (let i = 0; i < editor.lineCount(); i++) {
                            editor.indentLine(i, "smart");
                        }
                    });

                });
            });


        </script>

        <script>
            function updateEditorWidth() {
                const editorContainer = document.querySelector(".editor-container");
                const sidebar = document.querySelector(".sidebar");
                const codeMirrorScroll = document.querySelector(".CodeMirror-scroll");

                if (!editorContainer || !codeMirrorScroll) return;

                let windowWidth = window.innerWidth;

                let sidebarWidth = sidebar && window.getComputedStyle(sidebar).display !== "none"
                ? sidebar.offsetWidth
                : 0;

                let availableWidth = windowWidth - sidebarWidth;
                codeMirrorScroll.style.maxWidth = `${availableWidth}px`;
                codeMirrorScroll.style.overflowX = "auto";
            }

            window.addEventListener("resize", updateEditorWidth);
            window.addEventListener("DOMContentLoaded", updateEditorWidth);

            document.getElementById("sidebar").addEventListener("click", function () {
                setTimeout(updateEditorWidth, 300);
            });

        </script>
    </body>
</html>
